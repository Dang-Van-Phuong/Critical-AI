<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Critical AI | Roles</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">

<style>
* {
  box-sizing: border-box;
  font-family: Inter, sans-serif;
}
body {
  margin: 0;
  background: radial-gradient(circle at top, #2B1E4A, #24163F 60%);
  color: #ffffff;
}

.topbar {
  position: fixed;
  top: 0;
  width: 100%;
  padding: 16px 64px;
  background: linear-gradient(135deg, #C52C5A, #4A5BFF);
  display: flex;
  justify-content: space-between;
  align-items: center;
  z-index: 1000;
}

.logo {
  font-weight: 900;
  font-size: 21px;
  color: white;
}

.topbar nav a {
  margin-left: 28px;
  text-decoration: none;
  font-weight: 600;
  font-size: 14px;
  color: white;
  opacity: 0.85;
}

.topbar nav a:hover {
  opacity: 1;
}


/* ===== MAIN ===== */
.container {
  padding-top: 140px;
  padding-left: 90px;
  padding-right: 90px;
}

h1 {
  font-size: 48px;
  font-weight: 900;
  margin-bottom: 12px;
  text-shadow:
    0 0 8px rgba(123,140,255,0.5),
    0 0 18px rgba(123,140,255,0.25);
}


.subtitle {
  margin-top: 0;
  margin-bottom: 40px;
  font-size: 15px;
  font-weight: 500;
  opacity: 0.75;
  letter-spacing: 0.3px;
}

/* ===== ROLE GRID ===== */
.roles {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 32px;
  margin-bottom: 50px;
}

/* ===== ROLE CARD ===== */
.role-card {
  background: rgba(255,255,255,0.04);
  border-radius: 20px;
  padding: 28px;
  border: 1px solid rgba(255,255,255,0.1);
  backdrop-filter: blur(12px);
  transition: all 0.25s ease;
  cursor: pointer;
}

.role-card:hover {
  transform: translateY(-6px);
  border-color: rgba(140,155,255,0.9);
  background: rgba(140,155,255,0.08);
}

.role-card.completed {
  border: 2px solid #7b8cff;
  background: rgba(74,91,255,0.18);
}

.role-card h2 {
  font-size: 24px;
  margin-bottom: 14px;
  font-weight: 800;
  position: relative;
  display: inline-block;
  transition: 0.3s ease;

  background: linear-gradient(90deg, #FF2E88, #5B3CFF);
  background-size: 200% 100%;
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
}


/* underline glow */
.role-card h2::after {
  content: "";
  position: absolute;
  left: 0;
  bottom: -6px;
  width: 0%;
  height: 3px;
  border-radius: 4px;
  background: linear-gradient(90deg, #C52C5A, #4A5BFF);
  box-shadow: 0 0 12px rgba(74,91,255,0.6);
  transition: 0.3s ease;
}

/* hover effect */
.role-card:hover h2 {
  background-position: right center;
  text-shadow:
    0 0 14px rgba(243, 56, 178, 0.928),
    0 0 28px #c9097992;
}


.role-card:hover h2::after {
  width: 100%;
}

.role-card.completed h2 {
  background: linear-gradient(90deg, #FF2E88, #5B3CFF);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
}


.role-card p {
  font-size: 15.5px;
  line-height: 1.6;
  color: #cfd1e6;
}

/* ===== BUTTON AREA ===== */
.button-group {
  margin-top: 20px;
}

button {
  padding: 16px 44px;
  border-radius: 14px;
  font-size: 15px;
  font-weight: 700;
  border: none;
  cursor: pointer;
  margin-right: 14px;
  transition: 0.2s;
}

/* ===== SHARED GRADIENT BUTTON ===== */

.btn-back,
.btn-continue {
  padding: 16px 44px;
  border-radius: 14px;
  font-size: 15px;
  font-weight: 700;
  border: none;
  cursor: pointer;
  margin-right: 14px;
  transition: 0.25s ease;
  color: white;

  background: linear-gradient(90deg, #C52C5A, #4A5BFF);
  background-size: 200% 100%;
}

/* Back = n·ª≠a tr√°i */
.btn-back {
  background-position: left center;
}

/* Continue = n·ª≠a ph·∫£i */
.btn-continue {
  background-position: right center;
  display: none;
  box-shadow: 0 8px 24px rgba(74,91,255,0.35);
}

.btn-back:hover,
.btn-continue:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 30px rgba(74,91,255,0.45);
}


/* ===== DARK MODE GLOW ===== */
.role-card {
  box-shadow:
    0 0 20px rgba(74,91,255,0.25),
    0 0 50px rgba(197,44,90,0.15);
}

.role-card.completed {
  box-shadow:
    0 0 25px rgba(74,91,255,0.45),
    0 0 70px rgba(197,44,90,0.35);
}
/* ===== LIGHT MODE ===== */
body.light-mode {
  background: linear-gradient(180deg, #F8F9FF, #EEF1FF);
  color: #1E293B;
}
/* ===== LIGHT MODE TITLE GRADIENT ===== */

body.light-mode h1 {
  background: linear-gradient(135deg, #FF2E88, #5B3CFF);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow: none;
}


/* Role card light */
body.light-mode .role-card {
  background: #ffffff;
  border: 1px solid rgba(123,140,255,0.35);
  box-shadow:
    0 0 25px rgba(123,140,255,0.35),
    0 0 60px rgba(123,140,255,0.25);
}

body.light-mode .role-card p {
  color: #475569;
}

/* ===== LIGHT MODE COMPLETED CARD ===== */



body.light-mode .role-card.completed {
  background: linear-gradient(135deg, #fff0ff, #f5e3ff);
  border: 2px solid #770ce2;
  box-shadow:
    0 0 18px rgba(189, 46, 255, 0.35),
    0 0 40px rgba(192, 46, 255, 0.15);
}


body.light-mode .role-card h2 {
  text-shadow: 
    0 2px 4px rgba(255, 46, 245, 0.25),
    0 0 8px rgba(255,46,136,0.15);
}

body.light-mode .role-card.completed h2 {
  text-shadow: 
  0 2px 6px rgba(255, 46, 217, 0.35),
  0 0 12px rgba(255,46,136,0.25);

}


.theme-toggle-btn {
  position: fixed;
  bottom: 25px;
  right: 25px;

  width: 42px !important;
  height: 42px !important;
  min-width: 42px !important;
  min-height: 42px !important;

  padding: 0 !important;
  border-radius: 50% !important;

  display: flex;
  align-items: center;
  justify-content: center;

  border: none;
  background: linear-gradient(135deg, #C52C5A, #4A5BFF);
  color: white;
  font-size: 18px;
  cursor: pointer;
  line-height: 1;
  font-weight: normal;
  box-shadow: 0 6px 18px rgba(0,0,0,0.25);
  transition: 0.3s ease;
  z-index: 9999;
}
.theme-toggle-btn:hover {
  transform: scale(1.1);
}

/* Light mode button color */
body.light-mode .theme-toggle-btn {
  background: linear-gradient(135deg, #C52C5A, #4A5BFF);
}

</style>
</head>

<body>

<!-- ===== TOPBAR ===== -->
<div class="topbar">
  <div class="logo">Critical AI</div>
  <nav>
    <a href="Introduction.html">Gi·ªõi thi·ªáu</a>
    <a href="DefineIssue.html">Luy·ªán T·∫≠p</a>
    <a href="History.html">L·ªãch s·ª≠</a>
    <a href="Login.html">ƒêƒÉng nh·∫≠p</a>
  </nav>
</div>

<div class="container">

<h1>Ho√†n th√†nh t·∫•t c·∫£ c√°c g√≥c nh√¨n</h1>
<p class="subtitle">M·ªü kh√≥a ƒë·ªß 3 vai tr√≤ ƒë·ªÉ ti·∫øp t·ª•c</p>

<div class="roles" id="rolesContainer">
</div>


<div class="button-group">
  <button class="btn-back" onclick="goBack()">Quay l·∫°i</button>
  <button class="btn-continue" id="continueBtn" onclick="goNext()">Ti·∫øp t·ª•c</button>
</div>

</div>


<script>

const continueBtn = document.getElementById("continueBtn");
const rolesContainer = document.getElementById("rolesContainer");

let completedRoles = JSON.parse(localStorage.getItem("completedRoles")) || {};


// Load roles t·ª´ backend

// X√≥a d√≤ng n√†y n·∫øu kh√¥ng d√πng, ho·∫∑c ƒë·ªÉ l·∫°i ƒë·ªÉ debug
// let completedRoles = JSON.parse(localStorage.getItem("completedRoles")) || [];

async function loadRoles() {
  try {

    const debateId = localStorage.getItem("currentDebateId");

    if (!debateId) {
      window.location.href = "DefineIssue.html";
      return;
    }

const token = localStorage.getItem("token");

const res = await fetch("/get-roles", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    "Authorization": "Bearer " + token
  },
  body: JSON.stringify({ debateId })
});

    const data = await res.json();

    console.log("D·ªØ li·ªáu vai tr√≤:", data);

    if (!data || !data.role1) {
      window.location.href = "Overview.html";
      return;
    }

    renderRoles(data);

  } catch (err) {
    console.error("L·ªói fetch:", err);
    rolesContainer.innerHTML = "<p>L·ªói k·∫øt n·ªëi ƒë·∫øn server.</p>";
  }
}

function renderRoles(data) {
  rolesContainer.innerHTML = "";

  const currentRole = localStorage.getItem("currentRole");

  Object.keys(data).forEach((key) => {
    const role = data[key];
    const card = document.createElement("div");
    card.classList.add("role-card");
    card.dataset.role = key;

    // N·∫øu role ƒë√£ ho√†n th√†nh
    if (completedRoles[key]) {
      card.classList.add("completed");
    }

    // Highlight role ƒëang l√†m
    if (currentRole === key) {
      card.style.boxShadow = "0 0 30px rgba(255,255,255,0.4)";
    }

    card.innerHTML = `
      <h2>${role.ten}</h2>
      <p><strong>L·∫≠p tr∆∞·ªùng:</strong> ${role.lapTruong}</p>
      <p><strong>Ho√†n c·∫£nh:</strong> ${role.hoanCanh}</p>
      <p><strong>Nhi·ªám v·ª•:</strong> ${role.nhiemVu}</p>
    `;

    card.onclick = () => selectRole(card);
    rolesContainer.appendChild(card);
  });

  // Ki·ªÉm tra ƒë√£ ho√†n th√†nh h·∫øt ch∆∞a
checkAllCompleted();
}

async function checkAllCompleted(){
  try{

    const debateId = localStorage.getItem("currentDebateId");
    const token = localStorage.getItem("token");

    if (!debateId || !token) {
      window.location.href = "Login.html";
      return;
    }

    const res = await fetch("/debate-status", {
      method: "POST",
      headers: { 
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token
      },
      body: JSON.stringify({ debateId })
    });

    const data = await res.json();

    if(data.allCompleted){
      continueBtn.style.display = "inline-block";
    } else {
      continueBtn.style.display = "none";
    }

  } catch(err){
    console.error(err);
    continueBtn.style.display = "none";
  }
}

function selectRole(card) {
  const roleKey = card.dataset.role;
  localStorage.setItem("currentRole", roleKey);
  window.location.href = "Debate.html";
}

function goBack() {
  window.location.href = "Overview.html";
}

function goNext() {
  window.location.href = "Decision.html";
}

// G·ªçi h√†m
loadRoles();


</script>

<script>
function toggleTheme() {
  document.body.classList.toggle("light-mode");
  const btn = document.querySelector(".theme-toggle-btn");

  if (document.body.classList.contains("light-mode")) {
    localStorage.setItem("theme", "light");
    btn.textContent = "‚òÄ";
  } else {
    localStorage.setItem("theme", "dark");
    btn.textContent = "üåô";
  }
}

window.addEventListener("load", function () {
  const savedTheme = localStorage.getItem("theme");
  const btn = document.querySelector(".theme-toggle-btn");

  if (savedTheme === "light") {
    document.body.classList.add("light-mode");
    btn.textContent = "‚òÄ";
  }
});



//localStorage.removeItem("completedRoles");
</script>
<button class="theme-toggle-btn" onclick="toggleTheme()">üåô</button>
<script src="authFetch.js"></script>
</body>
</html>
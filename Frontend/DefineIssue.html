<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Critical AI | Define Issue</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">

<style>
* {
  box-sizing: border-box;
  font-family: Inter, sans-serif;
}

/* ================= ROOT ================= */
:root {
  --bg-dark-1: #2B1E4A;
  --bg-dark-2: #24163F;

  --primary-gradient: linear-gradient(135deg, #C52C5A, #4A5BFF);

  --glass-bg: rgba(255,255,255,0.05);
  --glass-border: rgba(123,140,255,0.25);

  --text-dark: #ffffff;
  --text-soft: #cfd1e6;

  --bg-light-1: #EEF0FF;
  --bg-light-2: #F7F8FF;

  --card-light: #ffffff;
  --border-light: rgba(74,91,255,0.35);

  --text-light-main: #1E1E2F;
  --text-light-soft: #475569;
}

/* ================= BODY ================= */
body {
  margin: 0;
  background: radial-gradient(circle at top, var(--bg-dark-1), var(--bg-dark-2) 60%);
  color: var(--text-dark);
}

/* ================= TOPBAR ================= */
.topbar {
  position: fixed;
  top: 0;
  width: 100%;
  padding: 16px 64px;
  background: var(--primary-gradient);
  display: flex;
  justify-content: space-between;
  align-items: center;
  z-index: 1000;
}

.topbar .logo {
  font-weight: 900;
  font-size: 21px;
  color: white;
}

.topbar nav a {
  margin-left: 28px;
  text-decoration: none;
  font-weight: 600;
  font-size: 14px;
  color: white;
  opacity: 0.8;
}

.topbar nav a:hover {
  opacity: 1;
}

/* ================= LAYOUT ================= */
.container {
  max-width: 950px;
  margin: auto;
  padding-top: 120px;
  padding-bottom: 80px;
}

/* ================= TITLE ================= */
h1 {
  font-size: 48px;
  font-weight: 900;
  margin-bottom: 12px;
  text-shadow:
    0 0 8px rgba(123,140,255,0.5),
    0 0 18px rgba(123,140,255,0.25);
}

.subtitle {
  opacity: 0.75;
  margin-bottom: 40px;
  color: var(--text-soft);
}

/* ================= GLASS CARD ================= */
.section-card {
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(123,140,255,0.35);
  backdrop-filter: blur(14px);
  box-shadow: 
    0 0 18px rgba(74,91,255,0.25),
    0 0 32px rgba(197,44,90,0.15);
  border-radius: 24px; 
  padding: 50px 60px;
  border-radius: 28px;
  margin-bottom: 40px;
}
.section-title { 
  font-size: 22px;
  font-weight: 800;
  margin-bottom: 28px;

  background: linear-gradient(135deg, #FF2E88, #5B3CFF);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;

  letter-spacing: 0.5px;
  position: relative;
}

/* g·∫°ch glow ph√≠a d∆∞·ªõi */
.section-title::after {
  content: "";
  position: absolute;
  left: 0;
  bottom: -8px;
  width: 60px;
  height: 4px;
  border-radius: 4px;
  background: linear-gradient(135deg, #C52C5A, #4A5BFF);
  box-shadow: 0 0 12px rgba(74,91,255,0.6);
}

/* ================= INPUT ================= */
label {
  font-weight: 600;
  font-size: 15px;
  display: block;
  margin-bottom: 12px;
}

textarea,
input[type="text"],
input[type="file"],
input[type="number"] {
  width: 100%;
  padding: 14px 16px;
  font-size: 16px;
  margin-bottom: 28px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,0.15);
  background: rgba(255,255,255,0.06);
  color: white;
  resize: vertical;
}

textarea:focus,
input[type="text"]:focus,
input[type="number"]:focus {
  outline: none;
  border-color: #4A5BFF;
  background: rgba(74,91,255,0.1);
}
/* ================= RADIO GRID ================= */
.radio-grid {
  display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 16px;
margin-bottom: 28px;
}
.radio-option {
  padding: 14px;
  border-radius: 14px;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.1);
  cursor: pointer;
  text-align: center;
  transition: 0.25s;

  display: flex;              /* th√™m */
  align-items: center;        /* th√™m */
  justify-content: center;    /* th√™m */
  line-height: 1.4;           /* th√™m */
}
.radio-option:hover {
  border-color: #4A5BFF;
}

.radio-option.active {
  background: rgba(74,91,255,0.2);
  border: 2px solid #4A5BFF;
}

/* ================= SCALE ================= */
.scale {
  display: flex;
  justify-content: space-between;
  gap: 12px;
}

.scale div {
  flex: 1;
  padding: 14px;
  border-radius: 14px;
  text-align: center;
  font-size: 14px;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.1);
  cursor: pointer;
  transition: 0.25s;
}

.scale div:hover {
  border-color: #4A5BFF;
}

.scale div.active {
  background: rgba(74,91,255,0.25);
  border: 2px solid #4A5BFF;
}

/* ================= BUTTON ================= */
button {
  margin-top: 20px;
  padding: 16px 32px;
  border-radius: 16px;
  border: none;
  font-weight: 700;
  font-size: 15px;
  cursor: pointer;
  background: var(--primary-gradient);
  color: white;
  transition: 0.25s ease;
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 28px rgba(74,91,255,0.35);
}

/* ================= LIGHT MODE ================= */
body.light-mode {
  background: radial-gradient(circle at top, var(--bg-light-1), var(--bg-light-2) 70%);
  color: var(--text-light-main);
}

body.light-mode h1 {
  background: linear-gradient(135deg, #FF2E88, #5B3CFF);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow: none;
}

body.light-mode .section-card {
  background: var(--card-light);
  border: 1px solid var(--border-light);
  box-shadow:
    0 0 20px rgba(74,91,255,0.25),
    0 0 40px rgba(197,44,90,0.15),
    inset 0 0 10px rgba(74,91,255,0.05);
}

body.light-mode textarea,
body.light-mode input[type="text"],
body.light-mode input[type="file"],
body.light-mode input[type="number"] {
  background: rgba(0,0,0,0.04);
  border: 1px solid rgba(0,0,0,0.1);
  color: #111;
}

body.light-mode .radio-option,
body.light-mode .scale div {
  background: rgba(0,0,0,0.04);
  border: 1px solid rgba(0,0,0,0.08);
}

body.light-mode .radio-option.active,
body.light-mode .scale div.active {
  background: rgba(252, 8, 236, 0.18);
  border: 2px solid #c80cd2;
}
body.light-mode .subtitle {
  color: #1E1E2F;
  opacity: 0.85;
}

/* ================= PROGRESS ================= */
.progress {
  width: 100%;
  height: 10px;
  background: rgba(255,255,255,0.1);
  border-radius: 20px;
  overflow: hidden;
  margin-bottom: 30px;
}

.progress-bar {
  height: 100%;
  width: 0%;
  background: linear-gradient(135deg, #C52C5A, #4A5BFF);
  border-radius: 20px;
  transition: width 0.3s ease;
  box-shadow: 0 0 12px rgba(74,91,255,0.6);
}

body.light-mode .progress {
  background: rgba(0,0,0,0.1);
}

/* ================= ERROR MESSAGE ================= */
.error-text {
  margin-top: -10px;
  margin-bottom: 20px;
  font-size: 14px;
  font-weight: 600;
  color: #ff4d6d;
  animation: fadeIn 0.2s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-4px); }
  to { opacity: 1; transform: translateY(0); }
}

#questionTitle {
  font-size: 20px;
  font-weight: 700;
  line-height: 1.5;
  margin-bottom: 22px;
}
textarea {
  min-height: 160px;
  font-size: 15px;
}

button {
  padding: 18px 40px;
  font-size: 16px;
  border-radius: 18px;
}
.multi-note{
  font-size: 15px;
  color: #6b7280;
  margin-bottom: 12px;
}

.instruction-box {
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,255,255,0.15);
  padding: 28px;
  border-radius: 18px;
  margin-bottom: 30px;
  line-height: 1.7;
  font-size: 15px;
  backdrop-filter: blur(10px);
}

.instruction-title {
  font-weight: 800;
  margin-bottom: 12px;
  font-size: 17px;
  background: linear-gradient(135deg, #FF2E88, #5B3CFF);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
}

body.light-mode .instruction-box {
  background: #ffffff;
  border: 1px solid rgba(74,91,255,0.3);
}
</style>
</head>

<body>

<div class="topbar">
  <div class="logo">Critical AI</div>
  <nav>
    <a href="Introduction.html">Gi·ªõi thi·ªáu</a>
    <a href="DefineIssue.html">Luy·ªán T·∫≠p</a>
    <a href="History.html">L·ªãch s·ª≠</a>
    <a href="Login.html">ƒêƒÉng nh·∫≠p</a>
  </nav>
</div>

<div class="container">

<h1>Nh·∫≠p v·∫•n ƒë·ªÅ</h1>
<div class="subtitle">H√£y l√†m r√µ v·∫•n ƒë·ªÅ tr∆∞·ªõc khi tham gia v√†o bu·ªïi luy·ªán t·∫≠p</div>

<div class="instruction-box" id="instructionBox">
  <div class="instruction-title">L∆∞u √Ω tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu</div>
  <div class="instruction-text">
    Vui l√≤ng vi·∫øt v·∫•n ƒë·ªÅ d∆∞·ªõi d·∫°ng m·ªôt ph√°t bi·ªÉu c√° nh√¢n (x∆∞ng ‚Äút√¥i‚Äù), 
    kh√¥ng s·ª≠ d·ª•ng c√¢u h·ªèi, ƒë·ªÉ h·ªá th·ªëng c√≥ th·ªÉ ph√¢n t√≠ch quan ƒëi·ªÉm c·ªßa b·∫°n m·ªôt c√°ch ch√≠nh x√°c.
    
    <br><br>
    <strong>V√≠ d·ª•:</strong><br>
    ‚Ä¢ T√¥i c·∫£m th·∫•y x√£ h·ªôi ƒëang ng√†y c√†ng thay ƒë·ªïi.<br>
    ‚Ä¢ T√¥i mu·ªën ngh·ªâ h·ªçc th√™m to√°n v√† t·ª± h·ªçc ·ªü nh√† v√¨ c·∫£m th·∫•y kh√¥ng c·∫ßn thi·∫øt.
  </div>
</div>
<div class="section-card">

<div class="progress">
  <div class="progress-bar" id="progressBar"></div>
</div>

<div id="questionTitle"></div>

<div id="questionContent"></div>

<div style="display:flex; justify-content:space-between;">
  <button onclick="prevStep()">Quay l·∫°i</button>
  <button id="nextBtn" onclick="nextStep()">Ti·∫øp t·ª•c</button>
</div>

</div>


</div>


<button class="theme-toggle-btn" onclick="toggleTheme()">üåô</button>

<style>
.theme-toggle-btn {
  position: fixed;
  bottom: 20px;
  right: 20px;

  font-size: 18px;
  font-weight: normal;

  width: 38px;
  height: 38px;
  min-width: 38px;
  min-height: 38px;

  padding: 0;
  border-radius: 50%;
  border: none;

  display: flex;
  align-items: center;
  justify-content: center;

  background: linear-gradient(135deg, #C52C5A, #4A5BFF);
  color: white;
  font-size: 16px;   /* nh·ªè l·∫°i */
  line-height: 1;

  cursor: pointer;
  box-shadow: 0 6px 16px rgba(0,0,0,0.25);
  transition: transform 0.2s ease;

  z-index: 9999;
}

.theme-toggle-btn:hover {
  transform: scale(1.1);
}

</style>

<script>
function toggleTheme() {
  document.body.classList.toggle("light-mode");
  const btn = document.querySelector(".theme-toggle-btn");

  if (document.body.classList.contains("light-mode")) {
    localStorage.setItem("theme", "light");
    btn.textContent = "‚òÄ";
  } else {
    localStorage.setItem("theme", "dark");
    btn.textContent = "üåô";
  }
}

/* LOAD SAVED THEME */
window.onload = function() {
  const savedTheme = localStorage.getItem("theme");
  const btn = document.querySelector(".theme-toggle-btn");

  if (savedTheme === "light") {
    document.body.classList.add("light-mode");
    btn.textContent = "‚òÄ";
  } else {
    btn.textContent = "üåô";
  }
};
</script>

<script>
const token = localStorage.getItem("token");

if (!token) {
  window.location.href = "Login.html";
}
</script>

<script>

const steps = [
{
  key: "loaiVanDe",
  title: "1. V·∫•n ƒë·ªÅ n√†y thu·ªôc lo·∫°i n√†o?",
  type: "radio",
  options: [
    "C√° nh√¢n",
    "H·ªçc t·∫≠p",
    "T√†i ch√≠nh",
    "Quan h·ªá",
    "ƒê·∫°o ƒë·ª©c",
    "C√¥ng ngh·ªá",
    "Kh√°c"
  ]
},
{
  key: "vanDeChinh",
  title: "2. B·∫°n ƒëang g·∫∑p v·∫•n ƒë·ªÅ / c√≥ quan ƒëi·ªÉm g√¨?",
  type: "textarea",
  placeholder: "Vi·∫øt 1‚Äì2 c√¢u, c√†ng c·ª• th·ªÉ c√†ng t·ªët.\nV√≠ d·ª•:\n- T√¥i mu·ªën ngh·ªâ CLB ƒë·ªÉ t·∫≠p trung h·ªçc.\n- T√¥i cho r·∫±ng √°p l·ª±c gia ƒë√¨nh gi√∫p t√¥i ti·∫øn b·ªô."
},
{
  key: "mucDoLienHe",
  title: "3. M·ª©c ƒë·ªô li√™n h·ªá v·ªõi b·∫°n",
  type: "radio",
  options: [
    "·∫¢nh h∆∞·ªüng tr·ª±c ti·∫øp ƒë·∫øn t√¥i hi·ªán t·∫°i",
    "·∫¢nh h∆∞·ªüng ƒë·∫øn t√¥i trong t∆∞∆°ng lai",
    "Ch·ªß y·∫øu ƒë·ªÉ hi·ªÉu th√™m / m·ªü r·ªông g√≥c nh√¨n",
    "Ch·ªâ l√† t√¨nh hu·ªëng gi·∫£ ƒë·ªãnh"
  ]
},
{
  key: "doiTuongTacDong",
  title: "4. Ai c√≥ th·ªÉ b·ªã t√°c ƒë·ªông b·ªüi v·∫•n ƒë·ªÅ n√†y?",
  type: "checkbox",
  maxSelect: 2,
  options: [
    "B·∫£n th√¢n t√¥i",
    "Gia ƒë√¨nh",
    "B·∫°n b√®",
    "T·∫≠p th·ªÉ / c·ªông ƒë·ªìng",
    "X√£ h·ªôi",
    "Kh√¥ng t√°c ƒë·ªông ƒë√°ng k·ªÉ"
  ]
},
{
  key: "hauQuaSai",
  title: "5. N·∫øu ƒë√°nh gi√° sai ho·∫∑c hi·ªÉu sai v·∫•n ƒë·ªÅ n√†y, h·∫≠u qu·∫£ l·ªõn nh·∫•t c√≥ th·ªÉ l√† g√¨?",
  type: "radio",
  options: [
    "Kh√¥ng ƒë√°ng k·ªÉ",
    "Hi·ªÉu sai b·∫£n ch·∫•t v·∫•n ƒë·ªÅ",
    "M·∫•t th·ªùi gian / c√¥ng s·ª©c/ ti·ªÅn b·∫°c",
    "M·∫•t c∆° h·ªôi",
    "·∫¢nh h∆∞·ªüng ng∆∞·ªùi kh√°c/ m·ªëi quan h·ªá",
    "·∫¢nh h∆∞·ªüng h·ªçc t·∫≠p / t∆∞∆°ng lai"
  ]
},
{
  key: "trangThai",
  title: "6. Tr·∫°ng th√°i c·ªßa b·∫°n hi·ªán t·∫°i ƒë·ªëi v·ªõi v·∫•n ƒë·ªÅ n√†y",
  type: "radio",
  options: [
    "T√¥i ƒë√£ nghi√™ng v·ªÅ m·ªôt h∆∞·ªõng c·ª• th·ªÉ",
    "T√¥i ƒëang ph√¢n v√¢n gi·ªØa nhi·ªÅu kh·∫£ nƒÉng",
    "T√¥i ch∆∞a c√≥ l·∫≠p tr∆∞·ªùng r√µ r√†ng"
  ]
},
{
  key: "tuTin",
  title: "7. M·ª©c t·ª± tin v√†o quan ƒëi·ªÉm hi·ªán t·∫°i (0‚Äì100%)",
  type: "range"
}
];

let currentStep = 0;
const answers = {};

const titleEl = document.getElementById("questionTitle");
const contentEl = document.getElementById("questionContent");
const progressBar = document.getElementById("progressBar");
const nextBtn = document.getElementById("nextBtn");

let errorEl = null;

// ===== RESTORE DRAFT IF EXISTS =====
const savedAnswers = localStorage.getItem("draftAnswers");
const savedStep = localStorage.getItem("draftStep");

const urlParams = new URLSearchParams(window.location.search);
const resume = urlParams.get("resume");

if(resume === "true"){
  if(savedAnswers){
    Object.assign(answers, JSON.parse(savedAnswers));
  }
  if(savedStep){
    currentStep = parseInt(savedStep);
  }
} else {
  localStorage.removeItem("draftAnswers");
  localStorage.removeItem("draftStep");
}


function renderStep() {

  const instructionBox = document.getElementById("instructionBox");

if(currentStep === 0){
  instructionBox.style.display = "block";
}else{
  instructionBox.style.display = "none";
}

  const step = steps[currentStep];
  titleEl.innerText = step.title;

  // progress
  progressBar.style.width = ((currentStep + 1) / steps.length) * 100 + "%";

  contentEl.innerHTML = "";

  errorEl = document.createElement("div");
  errorEl.className = "error-text";
  errorEl.style.display = "none";

  /* ================= RADIO ================= */
if(step.type === "radio"){

  const grid = document.createElement("div");
  grid.className = "radio-grid";

  step.options.forEach(opt=>{
    const div = document.createElement("div");
    div.className = "radio-option";
    div.innerText = opt;

    if(answers[step.key] === opt){
      div.classList.add("active");
    }

    div.onclick = ()=>{
      document.querySelectorAll(".radio-option")
        .forEach(o=>o.classList.remove("active"));

      div.classList.add("active");
      answers[step.key] = opt;

      errorEl.style.display = "none";

      // ‚úÖ N·∫øu l√† c√¢u 6 th√¨ render l·∫°i ƒë·ªÉ hi·ªán l√Ω do
      if(step.key === "trangThai"){
        renderStep();
      }
    };

    grid.appendChild(div);
  });

  contentEl.appendChild(grid);

  // ‚úÖ HI·ªÜN √î NH·∫¨P L√ù DO CHO C√ÇU 6
  if(step.key === "trangThai" && answers.trangThai){

    const label = document.createElement("label");
    label.innerText = "Gi·∫£i th√≠ch ng·∫Øn g·ªçn v√¨ sao b·∫°n ch·ªçn tr·∫°ng th√°i n√†y:";

    const ta = document.createElement("textarea");
    ta.placeholder = "V√≠ d·ª•: T√¥i ƒë√£ nghi√™ng v·ªÅ h∆∞·ªõng ngh·ªâ h·ªçc th√™m v√¨ c·∫£m th·∫•y qu√° t·∫£i...";
    ta.value = answers.lyDoTrangThai || "";

    ta.oninput = ()=>{
      answers.lyDoTrangThai = ta.value;
      errorEl.style.display = "none";
    };

    contentEl.appendChild(label);
    contentEl.appendChild(ta);
  }
}

  /* ================= CHECKBOX ================= */
  if(step.type === "checkbox"){

    const grid = document.createElement("div");
    grid.className = "radio-grid";

    if(!answers[step.key]) answers[step.key] = [];

    step.options.forEach(opt=>{
      const div = document.createElement("div");
      div.className = "radio-option";
      div.innerText = opt;

      // FIX: gi·ªØ tr·∫°ng th√°i khi quay l·∫°i
      if(answers[step.key].includes(opt)){
        div.classList.add("active");
      }

      div.onclick = ()=>{

        const max = step.maxSelect || Infinity;

        if(div.classList.contains("active")){
          div.classList.remove("active");
          answers[step.key] =
            answers[step.key].filter(v=>v!==opt);
        } else {

          if(answers[step.key].length >= max){
            errorEl.innerText =
              `B·∫°n ch·ªâ ƒë∆∞·ª£c ch·ªçn t·ªëi ƒëa ${max} l·ª±a ch·ªçn.`;
            errorEl.style.display = "block";
            return;
          }

          div.classList.add("active");
          answers[step.key].push(opt);
        }

        errorEl.style.display = "none";
      };

      grid.appendChild(div);
    });

    contentEl.appendChild(grid);
  }

  /* ================= TEXTAREA ================= */
  if(step.type === "textarea"){
    const ta = document.createElement("textarea");
    ta.placeholder = step.placeholder || "";
    ta.value = answers[step.key] || "";

    ta.oninput = ()=>{
      answers[step.key] = ta.value;
      errorEl.style.display = "none";
    };

    contentEl.appendChild(ta);
  }

  /* ================= RANGE (C√ÇU 7 FIX) ================= */
  if(step.type === "range"){

    const wrapper = document.createElement("div");

    const input = document.createElement("input");
    input.type = "range";
    input.min = 0;
    input.max = 100;
    input.value = answers[step.key] || 50;
    input.style.width = "100%";

    const valueLabel = document.createElement("div");
    valueLabel.style.marginTop = "12px";
    valueLabel.style.fontWeight = "600";
    valueLabel.innerText = input.value + "%";

    input.oninput = ()=>{
      answers[step.key] = input.value;
      valueLabel.innerText = input.value + "%";
      errorEl.style.display = "none";
    };

    wrapper.appendChild(input);
    wrapper.appendChild(valueLabel);
    contentEl.appendChild(wrapper);
  }

  contentEl.appendChild(errorEl);

  nextBtn.innerText =
    currentStep === steps.length - 1
    ? "T·ªïng quan"
    : "Ti·∫øp t·ª•c";
}

function nextStep(){

  const step = steps[currentStep];

  if(
  !answers[step.key] ||
  (Array.isArray(answers[step.key]) && answers[step.key].length === 0) ||
  (!Array.isArray(answers[step.key]) && answers[step.key].toString().trim() === "")
){

    errorEl.innerText = "B·∫°n ch∆∞a tr·∫£ l·ªùi c√¢u h·ªèi k√¨a, h√£y ho√†n th√†nh tr∆∞·ªõc khi ti·∫øp t·ª•c nh√©.";
    errorEl.style.display = "block";
    return;
  }

  errorEl.style.display = "none";


// B·∫Øt bu·ªôc nh·∫≠p l√Ω do ·ªü c√¢u 6
if(step.key === "trangThai"){
  if(!answers.lyDoTrangThai || answers.lyDoTrangThai.trim() === ""){
    errorEl.innerText = "B·∫°n c·∫ßn nh·∫≠p l√Ω do cho tr·∫°ng th√°i n√†y.";
    errorEl.style.display = "block";
    return;
  }
}
  if(currentStep < steps.length - 1){
    currentStep++;
    renderStep();
  } else {
    handleSubmit();
  }
  saveDraft();
}

function prevStep(){

  // N·∫øu ƒëang ·ªü b∆∞·ªõc ƒë·∫ßu ti√™n
  if(currentStep === 0){

    // L∆∞u t·∫°m answers v√†o localStorage tr∆∞·ªõc khi r·ªùi trang
    localStorage.setItem("draftAnswers", JSON.stringify(answers));
    localStorage.setItem("draftStep", currentStep);

    window.location.href = "Overview.html?resume=true";
    return;
  }

  // N·∫øu kh√¥ng th√¨ ch·ªâ quay l·∫°i step tr∆∞·ªõc
  currentStep--;
  renderStep();
}

async function handleSubmit(){

  nextBtn.disabled = true;

  let timeLeft = 15;
  nextBtn.innerText = `ƒêang kh√°i qu√°t v·∫•n ƒë·ªÅ... ${timeLeft}s`;

  const countdown = setInterval(()=>{
    timeLeft--;
    if(timeLeft > 0){
      nextBtn.innerText = `ƒêang kh√°i qu√°t v·∫•n ƒë·ªÅ... ${timeLeft}s`;
    } else {
      nextBtn.innerText = "AI ƒëang ph√¢n t√≠ch s√¢u h∆°n...";
      clearInterval(countdown);
    }
  },1000);

  localStorage.removeItem("currentDebateId");
  ["role1","role2","role3"].forEach(r=>{
    localStorage.removeItem("debateData_" + r);
  });
  localStorage.removeItem("completedRoles");

const data = {
  loaiVanDe: answers.loaiVanDe || "",
  vanDeChinh: answers.vanDeChinh || "",
  mucDoLienHe: answers.mucDoLienHe || "",
  doiTuongTacDong: answers.doiTuongTacDong || [],
  hauQuaSai: answers.hauQuaSai || "",
  trangThai: answers.trangThai || "",
  mucTuTin: answers.tuTin || 0
};

  try{
    const token = localStorage.getItem("token");

    const res = await fetch("/summarize",{
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        "Authorization":"Bearer "+token
      },
      body: JSON.stringify(data)
    });

    const result = await res.json();

if(!result.debateId){
  alert("AI ch∆∞a kh√°i qu√°t ƒë∆∞·ª£c v·∫•n ƒë·ªÅ. Vui l√≤ng th·ª≠ l·∫°i.");
  nextBtn.disabled = false;
  nextBtn.innerText = "T·ªïng quan";
  return;
}


clearInterval(countdown);

localStorage.setItem("currentDebateId", result.debateId);

// ‚úÖ X√ìA DRAFT TR∆Ø·ªöC KHI CHUY·ªÇN TRANG
localStorage.removeItem("draftAnswers");
localStorage.removeItem("draftStep");

window.location.href="Overview.html";

  }catch(error){
    clearInterval(countdown);
    alert("L·ªói k·∫øt n·ªëi server!");
    console.error(error);
    nextBtn.disabled = false;
    nextBtn.innerText = "T·ªïng quan";
  }
  
}


renderStep();

function saveDraft(){
  localStorage.setItem("draftAnswers", JSON.stringify(answers));
  localStorage.setItem("draftStep", currentStep);
}
</script>
<script src="authFetch.js"></script>
</body>
</html>
